/**
 * angular-localization :: v1.1.0 :: 2014-10-06
 * web: https://github.com/doshprompt/angular-localization
 *
 * Copyright (c) 2014 | Rahul Doshi
 * License: MIT
 */

!function(a){"use strict";a.module("ngLocalize.Config",[]).value("localeConf",{basePath:"languages",defaultLocale:"en-US",sharedDictionary:"common",fileExtension:".lang.json",persistSelection:!0,cookieName:"COOKIE_LOCALE_LANG",observableAttrs:new RegExp("^data-(?!ng-|i18n)"),delimiter:"::"}),a.module("ngLocalize.Events",[]).constant("localeEvents",{resourceUpdates:"ngLocalizeResourcesUpdated",localeChanges:"ngLocalizeLocaleChanged"}),a.module("ngLocalize",["ngCookies","ngSanitize","ngLocalize.Config","ngLocalize.Events","ngLocalize.InstalledLanguages"]).service("locale",["$http","$q","$log","$rootScope","$window","$cookieStore","localeConf","localeEvents","localeSupported","localeFallbacks",function(b,c,d,e,f,g,h,i,j,k){function l(a){return a&&a.length&&new RegExp("^[\\w\\.-]+\\.[\\w\\.-]+\\w(:.*)?$").test(a)}function m(a){var b=a?a.split("."):"",c="";return b.length>1&&(c=b.slice(0,-1).join(".")),c}function n(a){var b=a?a.split("."):[],c="";return b.length&&(c=b[b.length-1]),c}function o(a){var b,c=null,d=a?a.split("."):[];if(d.length>1)for(c=y,b=0;b<d.length-1;b++){if(!c[d[b]]){c=null;break}c=c[d[b]]}return c}function p(a){var c,f=a?a.split("."):"",g=y,j=h.basePath+"/"+w;if(f.length>1){for(c=0;c<f.length-1;c++)g[f[c]]||(g[f[c]]={}),g=g[f[c]],j+="/"+f[c];g._loading||(g._loading=!0,j+=h.fileExtension,b.get(j).success(function(b){var c,d=m(a);for(c in b)b.hasOwnProperty(c)&&(g[c]=b[c]);delete g._loading,e.$broadcast(i.resourceUpdates),x[d]&&x[d].resolve(d)}).error(function(){d.error("[localizationService] Failed to load: "+j),delete g._loading}))}}function q(a){var b,d;return a=a||h.langFile,d=a+"._LOOKUP_",b=o(d),x[a]||(x[a]=c.defer()),b&&!b._loading?x[a].resolve(a):b||p(d),x[a].promise}function r(b){var d,e,f;if(a.isString(b))d=b.split(",");else{if(!a.isArray(b))throw new Error("locale.ready requires either an Array or comma-separated list.");d=b}return d.length>1?(f=[],d.forEach(function(a){f.push(q(a))}),e=c.all(f)):e=q(b),e}function s(b,c){var d=b,e=0;return c&&(a.isArray(c)?a.forEach(c,function(a,b){d=d.replace("%"+(b+1),a),d=d.replace("{"+(b+1)+"}",a)}):a.forEach(c,function(a,b){++e,d=d.replace("{"+b+"}",a),d=d.replace("%"+b,a),d=d.replace("%"+e,a),d=d.replace("{"+e+"}",a)})),d=d.replace(/\n/g,"<br>")}function t(b,c){var e,f,g,i="",j=!1;return a.isString(b)&&!c&&-1!=b.indexOf(h.delimiter)&&(g=b.split(h.delimiter),b=g[0],c=a.fromJson(g[1])),j=l(b),j?(a.isObject(c)||(c=[c]),e=o(b),e&&!e._loading?(f=n(b),e[f]?i=s(e[f],c):(d.info("[localizationService] Key not found: "+b),i="%%KEY_NOT_FOUND%%")):e||p(b)):i=b,i}function u(a){var b=-1!=j.indexOf(a)?a:k[a.split("-")[0]]||h.defaultLocale;b!=w&&(y={},x={},w=b,e.$broadcast(i.localeChanges,w),e.$broadcast(i.resourceUpdates),h.persistSelection&&g.put(h.cookieName,b))}function v(){return w}var w,x,y;return u(g.get(h.cookieName)||f.navigator.userLanguage||f.navigator.language),{ready:r,isToken:l,getPath:m,getKey:n,setLocale:u,getLocale:v,getString:t}}]).filter("i18n",["locale",function(a){return function(b,c){return a.getString(b,c)}}]).directive("i18n",["$sce","locale","localeEvents","localeConf",function(b,c,d,e){function f(a,c){c!==a.html()&&a.html(b.getTrustedHtml(c))}function g(a,b,d){c.isToken(b)?c.ready(c.getPath(b)).then(function(){f(a,c.getString(b,d))}):f(a,b)}return function(b,c,f){var h;f.$observe("i18n",function(a,b){a&&a!=b&&g(c,a,h)}),a.forEach(f.$attr,function(a,b){e.observableAttrs.test(a)&&f.$observe(b,function(a,d){(a&&a!=d||!h||!h[b])&&(h=h||{},h[b]=f[b],g(c,f.i18n,h))})}),b.$on(d.resourceUpdates,function(){g(c,f.i18n,h)}),b.$on(d.localeChanges,function(){g(c,f.i18n,h)})}}]).directive("i18nAttr",["locale","localeEvents",function(a,b){return function(c,d,e){function f(b,d){var f,h=c.$eval(d),i=[];for(var j in h)f=h[j],a.isToken(f)&&-1==i.indexOf(a.getPath(f))&&i.push(a.getPath(f));a.ready(i).then(function(){var b="";for(var c in h)f=h[c],b=a.getString(f),g[c]!==b&&e.$set(c,g[c]=b)})}var g={};e.$observe("i18nAttr",function(a,b){a&&a!=b&&f(d,a)}),c.$on(b.resourceUpdates,function(){f(d,e.i18nAttr)}),c.$on(b.localeChanges,function(){f(d,e.i18nAttr)})}}]),a.module("ngLocalize.InstalledLanguages",[]).value("localeSupported",["en-US"]).value("localeFallbacks",{en:"en-US"}),a.module("ngLocalize.Version",[]).constant("localeVer","v1.1.0")}(window.angular,window,document);
//# sourceMappingURL=angular-localization.min.map